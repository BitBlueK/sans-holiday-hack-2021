
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Strace Ltrace Retrace &#8212; SANS Xmas Challenge 2021</title>
    
  <link rel="stylesheet" href="static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="static/documentation_options.js"></script>
    <script src="static/jquery.js"></script>
    <script src="static/underscore.js"></script>
    <script src="static/doctools.js"></script>
    <script src="static/language_data.js"></script>
    <script src="static/togglebutton.js"></script>
    <script src="static/clipboard.min.js"></script>
    <script src="static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Wireshark" href="challenge11.html" />
    <link rel="prev" title="11. Customer Complaint Analysis" href="objective11.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">SANS Xmas Challenge 2021</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Christmas Challenge 2021 Report
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="objective1.html">
   1. The Beginning
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="objective2.html">
   2. Caramel Santaigo
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="prechallenge2.html">
     Exif Metadata
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="challenge2.html">
     Track the Elf!
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="objective3.html">
   3. Thaw Frost Tower’s Entrance
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="prechallenge3.html">
     Grepping for Gold
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="challenge3.html">
     WiFi &amp; Door Defrost
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="objective4.html">
   4. Slot Machine Investigation
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="prechallenge4.html">
     Logic Munchers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="challenge4.html">
     Slot Machine Hijack
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="objective5.html">
   5. Strange USB Device
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="prechallenge5.html">
     IPv6 Sandbox
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="challenge5.html">
     Rubber Ducky
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="objective6.html">
   6. Shellcode Primer
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="prechallenge6.html">
     Holiday Hero
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="challenge6.html">
     Assembly x86
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="objective7.html">
   7. Printer Exploitation
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="challenge7.html">
     Printer Exploitation
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="objective8.html">
   8. Kerberoasting
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="prechallenge8.html">
     HoHo… No (Fail2Ban)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="challenge8.html">
     Windows AD Exploit
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="objective9.html">
   9. Splunk!
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="prechallenge9.html">
     YARA Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="challenge9.html">
     Splunk
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="objective10.html">
   10. Now Hiring!
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="prechallenge10.html">
     IMDS Exploration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="challenge10.html">
     Frost Tower Challenge
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="objective11.html">
   11. Customer Complaint Analysis
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Strace Ltrace Retrace
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="challenge11.html">
     Wireshark
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="objective12.html">
   12. Frost Tower Website Checkup
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="prechallenge12.html">
     Python Game
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="challenge12.html">
     SQL Injection
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="objective13.html">
   13. FPGA Programming
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="prechallenge13.html">
     FPGA Programming - Prechallenge
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="challenge13.html">
     FPGA Programming - Challenge
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="sources/prechallenge11.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cotton-candy-machine">
   Cotton Candy Machine
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="strace-ltrace-retrace">
<span id="prech11"></span><h1>Strace Ltrace Retrace<a class="headerlink" href="#strace-ltrace-retrace" title="Permalink to this headline">¶</a></h1>
<p>Location: Kitchen</p>
<p>Tinsel Uptree asked for our help in order to repair the Cotton Candy Machine
that seemed to have a configuration error.
<br />
In exchange he said he would give us some hints in using Wireshark .. just in case we need it in some other challenge.
<br />
The cranberry this time was focused in particular on two commands really useful for diagnostic, instructional, and debugging tool in Linux systems.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">strace</span></code>: In the simplest case strace runs the specified command until it
exits.  It intercepts and records the system calls which are
called by a process and the signals which are received by a
process.  The name of each system call, its arguments and its
return value are printed on standard error or to the file
specified with the -o option.
<br/>
<code class="docutils literal notranslate"><span class="pre">ltrace</span></code>:  ltrace is a program that simply runs the specified command until
it exits.  It intercepts and records the dynamic library calls
which are called by the executed process and the signals which
are received by that process.  It can also intercept and print
the system calls executed by the program.</p>
</div>
<div class="section" id="cotton-candy-machine">
<h2>Cotton Candy Machine<a class="headerlink" href="#cotton-candy-machine" title="Permalink to this headline">¶</a></h2>
<p><img alt="candymachine" src="images/candymachine.png" /></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ltrace ./make_the_candy
fopen(&quot;registration.json&quot;, &quot;r&quot;)                           = 0
puts(&quot;Unable to open configuration fil&quot;...Unable to open configuration file.
)               = 35
+++ exited (status 1) +++
</pre></div>
</div>
<p>it seems a registration.json file is needed, let’s create it</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$echo &quot;{}&quot; &gt; registration.json
</pre></div>
</div>
<p>relaunch</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ltrace</span> <span class="o">./</span><span class="n">make_the_candy</span>
<span class="n">fopen</span><span class="p">(</span><span class="s2">&quot;registration.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>                           <span class="o">=</span> <span class="mh">0x556aaaead260</span>
<span class="n">getline</span><span class="p">(</span><span class="mh">0x7fffff5e80e0</span><span class="p">,</span> <span class="mh">0x7fffff5e80e8</span><span class="p">,</span> <span class="mh">0x556aaaead260</span><span class="p">,</span> <span class="mh">0x7fffff5e80e8</span><span class="p">)</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">strstr</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;Registration&quot;</span><span class="p">)</span>                            <span class="o">=</span> <span class="n">nil</span>
<span class="n">getline</span><span class="p">(</span><span class="mh">0x7fffff5e80e0</span><span class="p">,</span> <span class="mh">0x7fffff5e80e8</span><span class="p">,</span> <span class="mh">0x556aaaead260</span><span class="p">,</span> <span class="mh">0x7fffff5e80e8</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">puts</span><span class="p">(</span><span class="s2">&quot;Unregistered - Exiting.&quot;</span><span class="n">Unregistered</span> <span class="o">-</span> <span class="n">Exiting</span><span class="o">.</span>
<span class="p">)</span>                           <span class="o">=</span> <span class="mi">24</span>
<span class="o">+++</span> <span class="n">exited</span> <span class="p">(</span><span class="n">status</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+++</span>
</pre></div>
</div>
<p>mmmhh .. it complains that the Registration key in the json is not found. Let’s add it to our file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$echo &quot;{\&quot;Registration\&quot;:\&quot;test\&quot;}&quot;&gt; registration.json
</pre></div>
</div>
<p>and relaunch</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ltrace</span> <span class="o">./</span><span class="n">make_the_candy</span>
<span class="n">fopen</span><span class="p">(</span><span class="s2">&quot;registration.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>                           <span class="o">=</span> <span class="mh">0x5622c89dd260</span>
<span class="n">getline</span><span class="p">(</span><span class="mh">0x7ffc06416370</span><span class="p">,</span> <span class="mh">0x7ffc06416378</span><span class="p">,</span> <span class="mh">0x5622c89dd260</span><span class="p">,</span> <span class="mh">0x7ffc06416378</span><span class="p">)</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">strstr</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="n">Registration</span><span class="s2">&quot;:&quot;</span><span class="n">test</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;Registration&quot;</span><span class="p">)</span>       <span class="o">=</span> <span class="s2">&quot;Registration&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">}</span>\<span class="n">n</span><span class="s2">&quot;</span>
<span class="n">strchr</span><span class="p">(</span><span class="s2">&quot;Registration&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">}</span>\<span class="n">n</span><span class="s2">&quot;, &#39;:&#39;)                    = &quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">}</span>\<span class="n">n</span><span class="s2">&quot;</span>
<span class="n">strstr</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="n">test</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">)</span>                              <span class="o">=</span> <span class="n">nil</span>
<span class="n">getline</span><span class="p">(</span><span class="mh">0x7ffc06416370</span><span class="p">,</span> <span class="mh">0x7ffc06416378</span><span class="p">,</span> <span class="mh">0x5622c89dd260</span><span class="p">,</span> <span class="mh">0x7ffc06416378</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">puts</span><span class="p">(</span><span class="s2">&quot;Unregistered - Exiting.&quot;</span><span class="n">Unregistered</span> <span class="o">-</span> <span class="n">Exiting</span><span class="o">.</span>
<span class="p">)</span>                           <span class="o">=</span> <span class="mi">24</span>
</pre></div>
</div>
<p>now, during execution it’s complaining that the value True wasn’t found for the “Registration” key. Add it</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$echo &quot;{\&quot;Registration\&quot;:\&quot;True\&quot;}&quot;&gt; registration.json
</pre></div>
</div>
<p>and relaunch ..</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ltrace ./make_the_candy
fopen(&quot;registration.json&quot;, &quot;r&quot;)                         = 0x563edde92260
getline(0x7ffea69777c0, 0x7ffea69777c8, 0x563edde92260, 0x7ffea69777c8) = 24
strstr(&quot;{&quot;Registration&quot;:&quot;True&quot;}\n&quot;, &quot;Registration&quot;)     = &quot;Registration&quot;:&quot;True&quot;}\n&quot;
strchr(&quot;Registration&quot;:&quot;True&quot;}\n&quot;, &#39;:&#39;)                  = &quot;:&quot;True&quot;}\n&quot;
strstr(&quot;:&quot;True&quot;}\n&quot;, &quot;True&quot;)                            = &quot;True&quot;}\n&quot;
getline(0x7ffea69777c0, 0x7ffea69777c8, 0x563edde92260, 0x7ffea69777c8) = -1
system(&quot;/bin/initialize_cotton_candy_sys&quot;...

Launching...
</pre></div>
</div>
<p>Done. The Cotton Candy Machine is back to normal now.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="objective11.html" title="previous page">11. Customer Complaint Analysis</a>
    <a class='right-next' id="next-link" href="challenge11.html" title="next page">Wireshark</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Dani & Max<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>